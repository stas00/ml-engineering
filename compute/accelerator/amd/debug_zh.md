# debug - 中文翻译

## 工具

### ROCR_VISIBLE_DEVICES

选择特定的GPU（相当于`CUDA_VISIBLE_DEVICES`）：

```bash
ROCR_VISIBLE_DEVICES=0,1 python my-program.py
```

### rocm-smi

`rocm-smi`（相当于`nvidia-smi`）显示所有ROCm加速器的简洁状态。

例如，在一个有8个MI300X节点的系统中：
```bash
$ rocm-smi
========================================= ROCm 系统管理接口 =========================================
=================================================== 简明信息 ===================================================
设备 [型号 : 修订版]    温度        功率     分区      SCLK    MCLK    风扇  性能  功率限制  VRAM%  GPU%
        名称 (20字符)       (结点)  (插槽)  (内存, 计算)
====================================================================================================================
0       [0x74a1 : 0x00]       45.0°C      173.0W    NPS1, SPX       132Mhz  900Mhz  0%   自动  750.0W    0%   0%
        AMD Instinct MI300X
1       [0x74a1 : 0x00]       41.0°C      179.0W    NPS1, SPX       132Mhz  900Mhz  0%   自动  750.0W    0%   0%
        AMD Instinct MI300X
2       [0x74a1 : 0x00]       47.0°C      180.0W    NPS1, SPX       131Mhz  900Mhz  0%   自动  750.0W    0%   0%
        AMD Instinct MI300X
3       [0x74a1 : 0x00]       45.0°C      178.0W    NPS1, SPX       131Mhz  900Mhz  0%   自动  750.0W   17%   0%
        AMD Instinct MI300X
4       [0x74a1 : 0x00]       45.0°C      175.0W    NPS1, SPX       132Mhz  900Mhz  0%   自动  750.0W    0%   0%
        AMD Instinct MI300X
5       [0x74a1 : 0x00]       43.0°C      175.0W    NPS1, SPX       132Mhz  900Mhz  0%   自动  750.0W    0%   0%
        AMD Instinct MI300X
6       [0x74a1 : 0x00]       45.0°C      175.0W    NPS1, SPX       132Mhz  900Mhz  0%   自动  750.0W    0%   0%
        AMD Instinct MI300X
7       [0x74a1 : 0x00]       43.0°C      176.0W    NPS1, SPX       132Mhz  900Mhz  0%   自动  750.0W    0%   0%
        AMD Instinct MI300X
====================================================================================================================
=============================================== ROCm SMI 日志结束 ================================================
```

奇怪的是，它只显示了内存使用百分比，而不是实际使用量，这不是很实用。

一个方便的别名来实时查看更新：
```bash
alias wr='watch -n 1 rocm-smi'
```

### rocminfo

`rocminfo`（相当于`nvidia-smi -q`）显示每个加速器的详细信息。

这个命令同时显示CPU和GPU的信息。

以下是cpu0和gpu0的片段（注意它从节点0开始计数CPU，然后从节点2开始计数GPU）：
```bash
$ rocminfo
ROCk 模块已加载
=====================
HSA 系统属性
=====================
运行时版本：         1.1
系统时间戳频率：  1000.000000MHz
最大等待持续时间：  18446744073709551615 (0xFFFFFFFFFFFFFFFF) (计时器计数)
机器模型：           LARGE
系统字节序：         LITTLE
Mwaitx：              禁用
DMAbuf 支持：         是

==========
HSA 代理
==========
*******
代理 1
*******
  名称：                    AMD EPYC 9534 64核处理器
  UUID：                    CPU-XX
  市场名称：                AMD EPYC 9534 64核处理器
  供应商名称：              CPU
  特性：                    未指定
  配置文件：                全配置文件
  浮点舍入模式：          近似
  最大队列数量：          0(0x0)
  队列最小大小：          0(0x0)
  队列最大大小：          0(0x0)
  队列类型：              多队列
  节点：                  0
  设备类型：              CPU
  缓存信息：
    L1:                      32768(0x8000) KB
  芯片ID：                 0(0x0)
  ASIC 修订版：            0(0x0)
  缓存行大小：            64(0x40)
  最大时钟频率(MHz)：     2450
  BDFID：                  0
  内部节点ID：            0
  计算单元：              128
  每CU的SIMD：            0
  显卡引擎：              0
  显卡阵列/引擎：         0
  地址范围上的观察点：    1
  特性：                  无
  池信息：
    池 1
      段：                 全局；标志：细粒度
      大小：               792303268(0x2f3996a4) KB
      可分配：             是
      分配粒度：           4KB
      分配对齐：           4KB
      对所有人可访问：      是
    池 2
      段：                 全局；标志：内核参数，细粒度
      大小：               792303268(0x2f3996a4) KB
      可分配：             是
      分配粒度：           4KB
      分配对齐：           4KB
      对所有人可访问：      是
    池 3
      段：                 全局；标志：粗粒度
      大小：               792303268(0x2f3996a4) KB
      可分配：             是
      分配粒度：           4KB
      分配对齐：           4KB
      对所有人可访问：      是
  ISA 信息：
[...]

  名称：                    gfx942
  UUID：                    GPU-ababaeeffecddc50
  市场名称：                AMD Instinct MI300X
  供应商名称：              AMD
  特性：                    内核调度
  配置文件：                基础配置文件
  浮点舍入模式：          近似
  最大队列数量：          128(0x80)
  队列最小大小：          64(0x40)
  队列最大大小：          131072(0x20000)
  队列类型：              多队列
  节点：                  2
  设备类型：              GPU
  缓存信息：
    L1:                      16(0x10) KB
    L2:                      8192(0x2000) KB
  芯片ID：                 29857(0x74a1)
  ASIC 修订版：            1(0x1)
  缓存行大小：            64(0x40)
  最大时钟频率(MHz)：     2100
  BDFID：                  50688
  内部节点ID：            7
  计算单元：              304
  每CU的SIMD：            4
  显卡引擎：              32
  显卡阵列/引擎：         1
  地址范围上的观察点：    4
  与主机的相干访问：      否
  特性：                  内核调度
  快速F16操作：          是
  波前大小：              64(0x40)
  工作组最大大小：        1024(0x400)
  工作组最大大小/维：
    x                        1024(0x400)
    y                        1024(0x400)
    z                        1024(0x400)
  每CU的最大波数：        32(0x20)
  每CU的最大工作项：      2048(0x800)
  网格最大大小：          4294967295(0xffffffff)
  网格最大大小/维：
    x                        4294967295(0xffffffff)
    y                        4294967295(0xffffffff)
    z                        4294967295(0xffffffff)
  每工作组的最大fbarriers：   32
  数据包处理器微代码：::  132
  SDMA 引擎微代码：      19
  IOMMU 支持：           无
  池信息：
    池 1
      段：                 全局；标志：粗粒度
      大小：               201310208(0xbffc000) KB
      可分配：             是
      分配粒度：           4KB
      分配对齐：           4KB
      对所有人可访问：      否
    池 2
      段：                 全局；标志：扩展细粒度
      大小：               201310208(0xbffc000) KB
      可分配：             是
      分配粒度：           4KB
      分配对齐：           4KB
      对所有人可访问：      否
    池 3
      段：                 全局；标志：细粒度
      大小：               201310208(0xbffc000) KB
      可分配：             是
      分配粒度：           4KB
      分配对齐：           4KB
      对所有人可访问：      否
    池 4
      段：                 组
      大小：               64(0x40) KB
      可分配：             否
      分配粒度：           0KB
      分配对齐：           0KB
      对所有人可访问：      否
  ISA 信息：
    ISA 1
      名称：                    amdgcn-amd-amdhsa--gfx942:sramecc+:xnack-
      机器模型：                HSA_MACHINE_MODEL_LARGE
      配置文件：                HSA_PROFILE_BASE
      默认舍入模式：            近似
      默认舍入模式：            近似
      快速f16：                是
      工作组最大大小：          1024(0x400)
      工作组最大大小/维：
        x                        1024(0x400)
        y                        1024(0x400)
        z                        1024(0x400)
      网格最大大小：            4294967295(0xffffffff)
      网格最大大小/维：
        x                        4294967295(0xffffffff)
        y                        4294967295(0xffffffff)
        z                        4294967295(0xffffffff)
      FBarrier 最大大小：       32
```